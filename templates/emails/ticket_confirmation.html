{% extends "emails/base.html" %}
{% load static %}

{% block title %}隆Tu ticket est谩 listo! - {{ event.title }} - Tuki{% endblock %}

{% block content %}
<h1 class="greeting">隆Hola {{ attendee_name }}! </h1>

<p class="subtitle">
    隆Excelente noticia! Tu reserva para <strong>{{ event.title }}</strong> ha sido confirmada exitosamente. 
    Est谩s a solo unos pasos de vivir una experiencia incre铆ble.
</p>

<!-- Event Details Card -->
<div class="event-card">
    <h2 class="event-title">{{ event.title }}</h2>
    <p class="event-date">
         {{ event.start_date|date:"l, j \d\e F \d\e Y \a \l\a\s H:i" }}
    </p>
    <p class="event-location">
         {{ event.location.name }}{% if event.location.address %} - {{ event.location.address }}{% endif %}
    </p>
    {% if event.description %}
    <p style="font-size: 14px; color: #4b5563; margin: 12px 0 0 0; line-height: 1.5;">
        {{ event.description|truncatewords:30|safe }}
    </p>
    {% endif %}
</div>

<!-- Ticket Information -->
<div class="ticket-info">
    <div style="margin-bottom: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <div>
                <p class="ticket-number">Ticket #{{ ticket.ticket_number }}</p>
                <p class="attendee-name">{{ attendee_name }}</p>
            </div>
        </div>
        
        <!-- Desglose de precios -->
        {% if order.total > 0 %}
        <div style="background-color: rgba(255,255,255,0.1); border-radius: 8px; padding: 16px; margin-top: 16px;">
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="padding: 4px 0; font-size: 14px; color: rgba(255,255,255,0.9);">Precio sin cargo:</td>
                    <td style="padding: 4px 0; text-align: right; font-size: 14px; color: rgba(255,255,255,0.9);">
                        ${{ ticket.order_item.unit_price|floatformat:0 }} {{ order.currency }}
                    </td>
                </tr>
                {% if order.service_fee > 0 %}
                <tr>
                    <td style="padding: 4px 0; font-size: 14px; color: rgba(255,255,255,0.9);">Comisi贸n de Servicio:</td>
                    <td style="padding: 4px 0; text-align: right; font-size: 14px; color: rgba(255,255,255,0.9);">
                        ${{ order.service_fee|floatformat:0 }} {{ order.currency }}
                    </td>
                </tr>
                {% endif %}
                <tr style="border-top: 1px solid rgba(255,255,255,0.3);">
                    <td style="padding: 8px 0 4px 0; font-size: 16px; font-weight: 600; color: #ffffff;">Subtotal:</td>
                    <td style="padding: 8px 0 4px 0; text-align: right; font-size: 16px; font-weight: 600; color: #ffffff;">
                        ${{ order.total|floatformat:0 }} {{ order.currency }}
                    </td>
                </tr>
            </table>
        </div>
        {% else %}
        <div style="text-align: center; margin-top: 16px;">
            <p style="font-size: 18px; font-weight: 600; margin: 0; color: #10b981;">
                GRATUITO
            </p>
        </div>
        {% endif %}
    </div>
    
    <div style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 16px;">
        <p style="font-size: 14px; margin: 0; opacity: 0.9;">
            Tipo de ticket: {{ ticket.order_item.ticket_tier.name }}
        </p>
        {% if order.order_number %}
        <p style="font-size: 14px; margin: 4px 0 0 0; opacity: 0.9;">
            Orden: {{ order.order_number }}
        </p>
        {% endif %}
    </div>
</div>

<!-- QR Code -->
<div style="text-align: center; margin: 32px 0;">
    <div style="background-color: #ffffff; border: 2px solid #268078; border-radius: 12px; padding: 40px; display: inline-block;">
        <div style="width: 150px; height: 150px; margin: 0 auto 16px; border-radius: 8px; overflow: hidden;">
            <img src="cid:qr_code" alt="QR Code para {{ ticket.ticket_number }}" style="width: 100%; height: 100%; object-fit: contain;">
        </div>
        <p style="font-size: 14px; color: #4b5563; margin: 0; font-weight: 500;">
            Presenta este c贸digo QR en el evento
        </p>
        <p style="font-size: 12px; color: #6b7280; margin: 8px 0 0 0;">
            Ticket: {{ ticket.ticket_number }}
        </p>
    </div>
</div>

<!-- Call to Action -->
<div style="text-align: center; margin: 32px 0;">
    <a href="https://tuki.live/tickets/{{ ticket.ticket_number }}" class="cta-button">
        Ver mi ticket completo
    </a>
</div>

<!-- Important Information -->
<div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; margin: 24px 0; border-radius: 6px;">
    <h3 style="color: #92400e; font-size: 16px; margin: 0 0 8px 0; font-weight: 600;">
         Informaci贸n importante
    </h3>
    <ul style="color: #92400e; font-size: 14px; margin: 0; padding-left: 20px; line-height: 1.6;">
        <li>Llega 15 minutos antes del evento</li>
        <li>Presenta tu QR code o ticket n煤mero {{ ticket.ticket_number }}</li>
        <li>Lleva un documento de identidad</li>
        {% if event.age_restriction %}
        <li>Restricci贸n de edad: {{ event.age_restriction }}</li>
        {% endif %}
        {% if event.dresscode %}
        <li>C贸digo de vestimenta: {{ event.dresscode }}</li>
        {% endif %}
    </ul>
</div>

<!-- Contact Information -->
<div style="text-align: center; margin: 32px 0 0 0;">
    <p style="font-size: 14px; color: #6b7280; margin: 0 0 16px 0;">
        驴Tienes alguna pregunta sobre el evento?
    </p>
    <p style="font-size: 14px; margin: 0;">
        <a href="mailto:{{ event.organizer.email|default:'info@tuki.cl' }}" style="color: #268078; text-decoration: none; font-weight: 500;">
            Contactar al organizador
        </a>
    </p>
</div>

{% endblock %}

