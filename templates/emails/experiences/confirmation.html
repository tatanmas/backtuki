{% extends "emails/base.html" %}
{% load static %}

{% block title %}ConfirmaciÃ³n de Reserva - {{ experience.title }} - Tuki{% endblock %}

{% block content %}
<!-- Template: ConfirmaciÃ³n de Experiencia -->
<div style="max-width: 600px; margin: 0 auto; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333333;">

    <!-- Header Simple -->
    <div style="text-align: center; padding: 40px 0 60px 0; border-bottom: 1px solid #e5e7eb;">
        <h1 style="font-size: 24px; font-weight: 400; color: #1f2937; margin: 0 0 8px 0;">
            âœ… Reserva Confirmada
        </h1>
        <p style="font-size: 16px; color: #6b7280; margin: 0;">
            Hola {{ customer_name }}, tu reserva ha sido confirmada exitosamente
        </p>
    </div>

    <!-- InformaciÃ³n de la Experiencia con Imagen -->
    <div style="padding: 40px 0; border-bottom: 1px solid #f3f4f6;">
        <div style="display: flex; gap: 32px; align-items: flex-start;">
            <!-- Imagen de la Experiencia -->
            <div style="flex-shrink: 0; width: 200px;">
                {% if experience_data.images and experience_data.images.0 %}
                <img src="{{ experience_data.images.0 }}" alt="{{ experience.title }}" style="width: 200px; height: 200px; object-fit: cover; border-radius: 8px; border: 1px solid #e5e7eb;">
                {% else %}
                <div style="width: 200px; height: 200px; background-color: #f3f4f6; border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 1px solid #e5e7eb;">
                    <span style="color: #9ca3af; font-size: 14px;">Sin imagen</span>
                </div>
                {% endif %}
            </div>
            
            <!-- InformaciÃ³n de la Experiencia -->
            <div style="flex: 1;">
                <h2 style="font-size: 24px; font-weight: 600; color: #268078; margin: 0 0 16px 0;">
                    {{ experience.title }}
                </h2>
                
                {% if experience_data.short_description %}
                <p style="font-size: 14px; color: #6b7280; margin: 0 0 20px 0; line-height: 1.5;">
                    {{ experience_data.short_description|striptags|truncatewords:25 }}
                </p>
                {% endif %}
                
                <table style="width: 100%; border-collapse: collapse; margin: 0;">
                    <tr>
                        <td style="padding: 8px 0; width: 30%; font-size: 14px; color: #6b7280; font-weight: 500;">Fecha:</td>
                        <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ instance_data.start_datetime|date:"l, j \d\e F \d\e Y" }}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px 0; font-size: 14px; color: #6b7280; font-weight: 500;">Hora:</td>
                        <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ instance_data.start_datetime|date:"H:i" }}</td>
                    </tr>
                    {% if experience_data.duration_minutes %}
                    <tr>
                        <td style="padding: 8px 0; font-size: 14px; color: #6b7280; font-weight: 500;">DuraciÃ³n:</td>
                        <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ experience_data.duration_minutes }} minutos</td>
                    </tr>
                    {% endif %}
                    {% if experience_data.location_name %}
                    <tr>
                        <td style="padding: 8px 0; font-size: 14px; color: #6b7280; font-weight: 500;">UbicaciÃ³n:</td>
                        <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">
                            {{ experience_data.location_name }}
                            {% if experience_data.location_address %}<br><span style="font-size: 13px; color: #6b7280;">{{ experience_data.location_address }}</span>{% endif %}
                        </td>
                    </tr>
                    {% endif %}
                    {% if instance_data.language_name %}
                    <tr>
                        <td style="padding: 8px 0; font-size: 14px; color: #6b7280; font-weight: 500;">Idioma:</td>
                        <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ instance_data.language_name }}</td>
                    </tr>
                    {% endif %}
                </table>
            </div>
        </div>
    </div>

    <!-- Detalles de la Reserva -->
    <div style="padding: 40px 0; border-bottom: 1px solid #f3f4f6;">
        <h3 style="font-size: 18px; font-weight: 600; color: #1f2937; margin: 0 0 24px 0;">
            Detalles de tu Reserva
        </h3>
        
        <!-- InformaciÃ³n de la Reserva -->
        <table style="width: 100%; border-collapse: collapse; margin: 0 0 32px 0;">
            <tr>
                <td style="padding: 8px 0; width: 40%; font-size: 14px; color: #6b7280;">CÃ³digo de Reserva:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600; font-family: monospace;">{{ reservation_data.reservation_id }}</td>
            </tr>
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">NÃºmero de Orden:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600; font-family: monospace;">{{ order.order_number }}</td>
            </tr>
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Fecha de Reserva:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937;">{{ order.created_at|date:"j \d\e F, Y \a \l\a\s H:i" }}</td>
            </tr>
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Nombre:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937;">{{ customer_name }}</td>
            </tr>
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Email:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937;">{{ customer_email }}</td>
            </tr>
            {% if customer_phone %}
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">TelÃ©fono:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937;">{{ customer_phone }}</td>
            </tr>
            {% endif %}
        </table>

        <!-- Participantes -->
        <h4 style="font-size: 16px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;">
            Participantes
        </h4>
        <table style="width: 100%; border-collapse: collapse; margin: 0 0 32px 0;">
            {% if reservation_data.adult_count > 0 %}
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Adultos:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ reservation_data.adult_count }}</td>
            </tr>
            {% endif %}
            {% if reservation_data.child_count > 0 %}
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">NiÃ±os:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ reservation_data.child_count }}</td>
            </tr>
            {% endif %}
            {% if reservation_data.infant_count > 0 %}
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Infantes:</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ reservation_data.infant_count }}</td>
            </tr>
            {% endif %}
            <tr style="border-top: 1px solid #f3f4f6;">
                <td style="padding: 12px 0 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">Total Participantes:</td>
                <td style="padding: 12px 0 8px 0; font-size: 14px; color: #1f2937; font-weight: 600;">{{ reservation_data.total_participants }}</td>
            </tr>
        </table>

        <!-- Recursos/Equipamiento (si hay) -->
        {% if resources %}
        <h4 style="font-size: 16px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;">
            Equipamiento Incluido
        </h4>
        <table style="width: 100%; border-collapse: collapse; margin: 0 0 32px 0;">
            {% for resource in resources %}
            <tr>
                <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">{{ resource.name }} (x{{ resource.quantity }}):</td>
                <td style="padding: 8px 0; font-size: 14px; color: #1f2937; text-align: right;">
                    {% if resource.price > 0 %}
                    ${{ resource.price|floatformat:0 }} {{ order.currency }}
                    {% else %}
                    Incluido
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% endif %}

        <!-- Resumen de Precios -->
        <div style="background-color: #f9fafb; padding: 24px; border-radius: 8px; margin-top: 32px;">
            <h4 style="font-size: 16px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;">
                Resumen de Pago
            </h4>
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Subtotal:</td>
                    <td style="padding: 8px 0; font-size: 14px; color: #1f2937; text-align: right;">${{ order_data.subtotal|floatformat:0 }} {{ order.currency }}</td>
                </tr>
                {% if order_data.service_fee > 0 %}
                <tr>
                    <td style="padding: 8px 0; font-size: 14px; color: #6b7280;">Cargo por servicio:</td>
                    <td style="padding: 8px 0; font-size: 14px; color: #1f2937; text-align: right;">${{ order_data.service_fee|floatformat:0 }} {{ order.currency }}</td>
                </tr>
                {% endif %}
                {% if order_data.discount > 0 %}
                <tr>
                    <td style="padding: 8px 0; font-size: 14px; color: #10b981;">Descuento:</td>
                    <td style="padding: 8px 0; font-size: 14px; color: #10b981; text-align: right;">-${{ order_data.discount|floatformat:0 }} {{ order.currency }}</td>
                </tr>
                {% endif %}
                <tr style="border-top: 2px solid #e5e7eb;">
                    <td style="padding: 16px 0 8px 0; font-size: 18px; color: #1f2937; font-weight: 700;">Total:</td>
                    <td style="padding: 16px 0 8px 0; font-size: 18px; color: #268078; font-weight: 700; text-align: right;">
                        {% if order_data.is_free %}
                        GRATIS
                        {% else %}
                        ${{ order_data.total|floatformat:0 }} {{ order.currency }}
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- InformaciÃ³n del Organizador -->
    <div style="padding: 40px 0; border-bottom: 1px solid #f3f4f6;">
        <h3 style="font-size: 18px; font-weight: 600; color: #1f2937; margin: 0 0 16px 0;">
            InformaciÃ³n del Organizador
        </h3>
        <p style="font-size: 14px; color: #6b7280; margin: 0 0 12px 0;">
            <strong style="color: #1f2937;">{{ organizer_data.name }}</strong>
        </p>
        {% if organizer_data.email %}
        <p style="font-size: 14px; color: #6b7280; margin: 0 0 8px 0;">
            ðŸ“§ {{ organizer_data.email }}
        </p>
        {% endif %}
        {% if organizer_data.phone %}
        <p style="font-size: 14px; color: #6b7280; margin: 0 0 8px 0;">
            ðŸ“ž {{ organizer_data.phone }}
        </p>
        {% endif %}
    </div>

    <!-- Footer -->
    <div style="padding: 40px 0; text-align: center;">
        <p style="font-size: 14px; color: #6b7280; margin: 0 0 16px 0;">
            Â¿Necesitas ayuda? ContÃ¡ctanos en <a href="mailto:{{ support_email }}" style="color: #268078; text-decoration: none;">{{ support_email }}</a>
        </p>
        <p style="font-size: 12px; color: #9ca3af; margin: 0;">
            Â© {{ current_year }} Tuki. Todos los derechos reservados.
        </p>
    </div>

</div>
{% endblock %}
